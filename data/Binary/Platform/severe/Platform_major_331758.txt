[backport] performance regression caused by fix in 298835